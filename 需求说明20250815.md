# LangGraph 节点配置示例

## preference_filter
- 类型: Filter
- 描述: 按景点受欢迎程度（beijing_poi.json文件中的popularity_score字段）以及个人偏好生成候选景点列表，共后续环节筛选。保证每天至少4个候选景点。举例：如果游玩两天，须有2*4=8个候选景点。
- 输入: 全量景点数据data/beijing_poi.json、用户偏好user_preferences、游玩天数
- 输出: 用户偏好景点列表candidate_pois
- 依赖: 无
- 回退: 无


## weather_filter
- 类型: Filter
- 描述: 根据每天的天气过滤候选景点（室外景点遇雨、雪等天气需替换）
- 输入: 排序后的候选景点列表candidate_pois、每日天气数据 daily_weather
- 输出: 每日天气可行景点列表weather_adjusted_pois
- 依赖: popularity_preferemce_filter
- 优化：若某天无可行景点，尝试跨天交换或引入次选景点；若仍不可行，回退
- 回退: popularity_preferemce_filter


## team_constraints
- 类型: Adjust
- 描述: 根据团队人数与构成限制游玩时长及住宿配置。如果只有成年人，每天游玩时间不超过12小时。如果有老人或者儿童每日游玩时间不超过9小时。住宿配置先以简单的计算规则进行：一个小孩算0.5个人，总人数求和取整后，除以2，将商和余数相加，即为需要预定的房间数量。
- 输入: 团队人员类型及人数
- 输出: 游玩时间限制daily_time_limit、住宿配置（需要多少间房）
- 依赖: 无
- 回退: 无

## route_feasibility
- 类型: Plan
- 描述: 安排景点、餐厅、酒店、交通方式，要求日内地点需要顺路，并满足每日时间限制。餐厅可根据用户偏好以及工具函数获取餐厅列表进行筛选，酒店可通过工具函数获取列表进行筛选。交通方式可根据工具函数获取相应信息。
- 输入: 每日天气可行景点列表weather_adjusted_pois、用户偏好餐厅restaurant_prefs、team_constraints
- 输出: daily_route_plan
- 依赖: weather_filter, team_constraints
- 优化：若顺路/时间限制或团队约束不满足，调整景点顺序、删减景点或跨天调整；若仍不可行，回退
- 回退: popularity_preferemce_filter

## time_window_check
- 类型: Check
- 描述: 检查景点开放时间和建议游玩时间是否满足。只能在景点开放时间游玩，每个景点也有建议游玩时间（suggested_duration_hours）。同时需满足到达景区时间与景点关闭时间之间时差>suggested_duration_hours。
- 输入: daily_route_plan、beijing_poi.json中的景区开放时间suggested_duration_hours
- 输出: 时间可行的每日景点列表time_feasible
- 依赖: route_feasibility
- 优化：若不满足，调整当天顺序或替换景点；若仍不可行，回退
- 回退: route_feasibility

## intensity_check
- 类型: Check
- 描述: 检查每日活动强度是否超过上限
- 输入: 时间可行景点列表time_window_check、活动强度分值（会在beijing_poi.json文件中增加该字段）
- 输出: 活动强度可行的每日景点列表intensity_feasible
- 依赖: time_window_check
- 优化：若超强度，减少当天景点或替换为低强度景点；回退
- 回退: route_feasibility

## budget_check
- 类型: Check
- 描述: 计算景点、餐饮、酒店、交通总花费，并检查预算
- 输入: 活动强度可行列表route_feasibility、价格信息、team_constraints
- 输出: 预算可行的行程方案budget_feasible
- 依赖: intensity_check, route_feasibility, team_constraints
- 优化：若超预算，优先调整高价环节（酒店→餐饮→景点），必要时回退 route_feasibility；若仍不可行，回退 preference_filter
- 回退: route_feasibility/preference_filter
